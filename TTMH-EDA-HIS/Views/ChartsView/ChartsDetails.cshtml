@model TTMH_EDA_HIS.ViewModels.ChartsViewModel
@{
    ViewData["Title"] = " 批價";
}

@section CSS{
    <link rel="stylesheet" href="~/lib/sweetalert2/sweetalert2.css" />
    <link rel="stylesheet" href="~/css/theme.css" asp-append-version="true" />
    <style>
        @@media (max-width:1780px) {
            .ED-media-1 {
                margin-top: 30px;
                width: 100% !important;
            }
        }

        .SC-input-button-form_submit {
            background-color: #4443a3;
            border-radius: 10px;
            border: 0px solid;
            color: white;
            font-size: 27px;
            padding: 15px;
            width: 85%;
        }

            .SC-input-button-form_submit:hover {
                background-color: #5554b4;
            }

            .SC-input-button-form_submit:focus {
                background-color: #5554b4;
            }

        .SC-btn {
            width: 152px;
            height: 52px;
            padding: 5px;
            background-color: #008F8D;
        }
    </style>
}
@*大框架*@
<div class="container-lg col-11 py-4">
    <div class="row" style="height: 100%">
        @*病人個資*@
        <div class="col-3">
            <div class="ED-media-1 py-3 row me-5 AT-bg-secondary-emphasis AT-rounded-1 rounded-4" style="width:510px;height:620px;">
                <div class="col-5">
                    @*<p class="h4 text-white align-content-center SC-btn AT-rounded-1">健保</p>*@
                    <div class="d-flex justify-content-center badge AT-bg-primary-deep AT-fs-25 text-wrap" style="width: 115px;height: 48px;">
                        @{
                            var status = Model.Patient.Status ?? "";
                        }
                        @if (status == "HealthInsurance")                        {
                            <p class="AT-fs-25 text-white lh-lg">
                                <div class="align-middle">
                                    健保
                                </div>
                            </p>
                        }
                        else
                        {
                            <p class="AT-fs-25 text-white lh-lg">
                                <div class="align-middle">
                                    非健保
                                </div>
                            </p>
                        }
                    </div>
                    <p class="AT-fs-25 text-white lh-lg text-end mt-3">繳費條號</p>
                    <p class="AT-fs-25 text-white lh-lg text-end mt-3">病例編號</p>
                    <p class="AT-fs-25 text-white lh-lg text-end mt-3">病患姓名</p>
                    <p class="AT-fs-25 text-white lh-lg text-end mt-3">性別</p>
                    <p class="AT-fs-25 text-white lh-lg text-end mt-3">出生年月日</p>
                    <p class="AT-fs-25 text-white lh-lg text-end mt-3">年齡</p>
                    <p class="AT-fs-25 text-white lh-lg text-end mt-3">看診醫生</p>
                    <p class="AT-fs-25 text-white lh-lg text-end mt-3">看診日期</p>
                </div>
                <div class="col-6">
                    <p class="AT-fs-25 text-white lh-lg"></p>
                    <p class="AT-fs-25 text-white lh-lg pt-5">@Model.DetId</p>
                    <p class="AT-fs-25 text-white lh-lg">@Model.Patient.CaseHistory</p>
                    <p class="AT-fs-25 text-white lh-lg">@Model.Patient.PatientName</p>
                    @if (Model.Patient.Gender == "1")
                    {
                        <p class="AT-fs-25 text-white lh-lg">
                            男
                        </p>
                    }
                    else if (Model.Patient.Gender == "2")
                    {
                        <p class="AT-fs-25 text-white lh-lg">
                            女
                        </p>
                    }
                    <p class="AT-fs-25 text-white lh-lg">@Model.birthday</p>
                    <p class="AT-fs-25 text-white lh-lg">@Model.age</p>
                    <p class="AT-fs-25 text-white lh-lg">@Model.docsName</p>
                    <p class="AT-fs-25 text-white lh-lg">@Model.Vdate</p>
                </div>
            </div>
        </div>

        @*查詢/批價內容*@
        <div class="col-9 d-flex justify-content-center row">
            @*輸入框*@
            <div class="row ms-3 d-flex justify-content-center">
                @*第一版*@
                @*<form class="d-flex row">
                <div class="form-group col ">
                <input type="text" class="form-control AT-fs-25 border-4 border-AT-fg-primary-deep" placeholder="請輸入繳費號/病例編號">
                </div>
                </form>*@
                @*第二版*@
                <input onkeypress="SearchKey(event)" id="search" type="text" class="form-control m-3 AT-fs-25 border-4 border-AT-fg-primary-deep" placeholder="請輸入繳費條號" style="width: 90%">
            </div>
            @*批價內容*@
            <!-- 圓角 + background -->
            <div class="row AT-rounded-1 AT-bg-fourth m-3 ms-5 d-flex justify-content-center" style="width: 85%">
                <div class="d-flex flex-row">
                    <!-- 項目 -->
                    <div class="col-6 pt-3">
                        <div class="AT-fs-30 text-secondary">
                            項目
                        </div>
                    </div>
                    <!-- 金額 -->
                    <div class="col-6 pt-3">
                        <div class="AT-fs-30 text-secondary">
                            金額
                        </div>
                    </div>
                </div>
                <hr class="BS-border border-3 opacity-75" />
                <div class="d-flex flex-row">
                    @*style="height: 70%"*@
                    <!-- 項目內容 -->
                    <div class="col-6">
                        <div class="AT-fs-30 text-secondary">
                            <p class="AT-fs-25 text-black lh-lg">掛號費</p>
                            <p class="AT-fs-25 text-black lh-lg">診察費</p>
                            <p class="AT-fs-25 text-black lh-lg">部分負擔</p>
                            <p class="AT-fs-25 text-black lh-lg">藥品部分負擔</p>
                            <p class="AT-fs-25 text-black lh-lg">藥費</p>
                        </div>
                    </div>
                    <!-- 金額內容 -->
                    <div class="col-6">
                        <div class="AT-fs-30 text-secondary"></div>
                        <p class="AT-fs-25 text-black lh-lg">@Model.Registration</p>
                        <p class="AT-fs-25 text-black lh-lg">@Model.Diagnostic</p>
                        <p class="AT-fs-25 text-black lh-lg">@Model.PartialPayment</p>
                        <p class="AT-fs-25 text-black lh-lg">@Model.DrugPartialPayment</p>
                        <p class="AT-fs-25 text-black lh-lg">@Model.MedicalCost</p>
                    </div>
                </div>
                <hr class="BS-border border-3 opacity-75" />
                <div class="d-flex flex-row">
                    <!-- 空白 -->
                    <div class="col-6">
                        <div class="AT-fs-30 text-secondary">
                        </div>
                    </div>
                    <!-- 應繳金額 -->
                    <div class="col-6">
                        <div class="AT-fs-30 text-secondary">
                            應繳金額：@Model.Payable
                        </div>
                    </div>
                </div>
            </div>
            @*完成繳費按鈕*@
            <div class="row d-flex flex-row mx-3">
                @*空白*@
                <div class="col-8"></div>
                @*按鈕*@
                <div class="col-4 d-flex justify-content-center">
                    <form asp-action="ChartsDetails" method="post">
                        <input type="text" asp-for="DetId" value="@Model.DetId" style="display:none;">
                        <button type="submit" class="BS-btn SC-input-button-form_submit btn m-4 p-2" style="width:220px;height:60px;">
                            @*id="Post"*@
                            完成繳費
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Script{
    <script src="~/lib/sweetalert2/sweetalert2.all.js"></script>
    <script>

        const StatusCode = @Model.StatusCode;
        //const PaymentTime = "Model.PaymentTime.ToString()"";

        function SearchKey(event) {
            var search = document.getElementById("search");
            if (event.key == "Enter") {
                window.location.assign(`https://${location.hostname}:${location.port}/ChartsView/ChartsDetailsSearch?q=${search.value}`);
            }
        }

        window.onload = () => {
            switch (StatusCode) {
                case 1: //Paid
                    Swal.fire({
                        icon: 'warning',
                        title: 'Oops...',
                        text: '已繳費過了',
                        //footer: '<a href="">Why do I have this issue?</a>'
                    });
                    break;
                case 2: //No Result
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: '查無資料',
                        //footer: '<a href="">Why do I have this issue?</a>'
                    });
                    break;
                case 3:
                    Swal.fire({
                        position: 'center',
                        icon: 'success',
                        title: '完成繳費',
                        showConfirmButton: false,
                        timer: 1500
                    });
                    break;
            }
            if (StatusCode <= 4 && StatusCode > 0) {
                document.querySelector("form button").setAttribute("disabled", "");
            }
        }

    </script>
}
